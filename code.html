<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CodeMentor Pro — AI-Powered Full-Stack Coach</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-0: #071026;
    --bg-1: #0f1724;
    --card: #0b1220;
    --muted: #96a0b8;
    --accent: #00C2A8;
    --grad1: #4B6CB7;
    --grad2: #8A2BE2;
    --glass: rgba(255,255,255,0.03);
    --radius: 14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background: linear-gradient(180deg,var(--bg-0),var(--bg-1) 60%);
    color:#E6EEF8; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    padding:20px;
  }

  /* Header */
  header.app-header{
    display:flex; align-items:center; gap:14px; padding:14px; border-radius:12px;
    background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    backdrop-filter: blur(6px); margin-bottom:16px;
  }
  .brand{
    display:flex; align-items:center; gap:12px;
  }
  .logo-mark{
    width:46px; height:46px; border-radius:12px; display:grid; place-items:center;
    background: linear-gradient(135deg, var(--grad1), var(--grad2));
    box-shadow: 0 6px 18px rgba(74,58,255,0.12);
  }
  .logo-mark svg{filter: drop-shadow(0 2px 6px rgba(0,0,0,0.45))}
  h1{font-size:18px;margin:0}
  p.subtitle{margin:0;color:var(--muted);font-size:13px}

  nav.top-nav{margin-left:auto; display:flex; gap:12px; align-items:center}
  .nav-btn{background:transparent;border:0;color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}
  .nav-btn.active{background:linear-gradient(90deg,var(--grad1),var(--grad2)); color:#fff; font-weight:600;}

  /* Layout grid */
  .layout{
    display:grid; grid-template-columns:260px 1fr 340px; gap:18px; max-width:1200px; margin:0 auto;
  }

  /* Left sidebar (examples + controls) */
  .sidebar{
    background:var(--card); border-radius:var(--radius); padding:12px; height:72vh; overflow:auto;
  }
  .sidebar h3{margin:0 0 10px 0; font-size:13px; color:#F3F7FF}
  .example{
    display:flex; align-items:center; gap:10px; padding:8px; border-radius:10px; cursor:pointer;
    transition: background .15s;
  }
  .example:hover{background:rgba(255,255,255,0.02)}
  .avatar{
    width:40px;height:40px;border-radius:8px;display:grid;place-items:center;font-weight:700;color:#fff;
    font-size:13px;
  }
  .small-muted{color:var(--muted); font-size:13px}
  .controls{margin-top:12px;display:flex;gap:8px}

  /* Main chat */
  .chat{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:var(--radius); padding:12px; height:72vh; display:flex; flex-direction:column;
  }
  .messages{flex:1; overflow:auto; padding-right:8px; display:flex; flex-direction:column; gap:10px}
  .msg{
    max-width:78%; padding:12px 14px; border-radius:12px; line-height:1.35; animation: fadeIn .18s ease;
  }
  .msg.me{align-self:flex-end; background:#07132a; border:1px solid rgba(255,255,255,0.03)}
  .msg.bot{background:linear-gradient(180deg, rgba(75,108,183,0.12), rgba(138,43,226,0.06)); border:1px solid rgba(138,43,226,0.07)}
  .msg strong{display:block}
  .assistant-format{display:inline-block;margin-top:8px;padding:6px 8px;background:rgba(0,0,0,0.22);border-radius:8px;color:var(--muted);font-size:12px}

  .composer{display:flex; gap:8px; margin-top:10px; align-items:flex-end}
  textarea#input{
    flex:1; min-height:56px; resize:none; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.04);
    background:var(--glass); color:inherit; font-size:14px;
  }
  button.send{background:linear-gradient(90deg,var(--grad1),var(--grad2)); border:0; color:white; padding:12px 14px; border-radius:12px; cursor:pointer}
  .meta{font-size:12px;color:var(--muted); margin-top:6px}

  /* Right panel (tabs) */
  .sidepanel{ background:var(--card); border-radius:var(--radius); padding:12px; height:72vh; overflow:auto;}
  .tabs{display:flex; gap:8px; margin-bottom:10px}
  .tab{padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--muted); background:transparent; border:1px solid transparent}
  .tab.active{background:linear-gradient(90deg,var(--grad1),var(--grad2)); color:#fff; font-weight:600; border:1px solid rgba(255,255,255,0.04)}
  .panel{background:transparent;border-radius:10px;padding:8px}
  pre.code-block{background:#051226;padding:10px;border-radius:10px;color:#CBE7FF;overflow:auto;max-height:42vh}
  ol.steps{color:var(--muted); margin-left:16px}
  ul.tips{color:var(--muted); margin-left:16px}
  .small-note{font-size:13px;color:var(--muted);margin-top:8px}

  /* Resources & About layout (full-width modal-ish) */
  .resources-list{display:flex;flex-direction:column; gap:8px}
  .resource{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02); color:var(--muted)}

  /* footer */
  footer{max-width:1200px;margin:16px auto 0; color:var(--muted); font-size:13px}

  /* Animations & responsive */
  @keyframes fadeIn{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
  @media(max-width:980px){
    .layout{grid-template-columns:1fr; gap:12px}
    .sidebar, .sidepanel{display:none}
    .chat{height:auto}
  }
</style>
</head>
<body>
  <header class="app-header" role="banner">
    <div class="brand">
      <div class="logo-mark" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M7 3C5 5 6 8 6 8v8s-1 3 1 5" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 3c2 2 1 5 1 5v8s1 3-1 5" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div>
        <h1>{ } CodeMentor Pro</h1>
        <p class="subtitle">AI-powered full-stack coach — friendly, India-first</p>
      </div>
    </div>

    <nav class="top-nav" aria-label="Main navigation">
      <button class="nav-btn active" id="nav-chat">Chat</button>
      <button class="nav-btn" id="nav-resources">Resources</button>
      <button class="nav-btn" id="nav-about">About</button>
    </nav>
  </header>

  <main class="layout" role="main">
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Examples & Controls">
      <h3>Quick examples</h3>

      <div class="example" data-idx="0" onclick="loadExample(0)">
        <div class="avatar" style="background:linear-gradient(135deg,var(--grad1),var(--grad2))">Q1</div>
        <div>
          <div><strong>Explain API in simple words</strong></div>
          <div class="small-muted">Waiter analogy + Google Maps example</div>
        </div>
      </div>

      <div class="example" data-idx="1" onclick="loadExample(1)">
        <div class="avatar" style="background:linear-gradient(135deg,#8A2BE2,#B23EFF)">Q2</div>
        <div>
          <div><strong>Connect PHP form to MySQL</strong></div>
          <div class="small-muted">mysqli_connect, prepared statements</div>
        </div>
      </div>

      <div class="example" data-idx="2" onclick="loadExample(2)">
        <div class="avatar" style="background:linear-gradient(135deg,#00C2A8,#00E0C2)">Q3</div>
        <div>
          <div><strong>What to include in my portfolio</strong></div>
          <div class="small-muted">About, Skills, Projects, Contact</div>
        </div>
      </div>

      <div class="example" data-idx="3" onclick="loadExample(3)">
        <div class="avatar" style="background:linear-gradient(135deg,#4B6CB7,#8A2BE2)">Q4</div>
        <div>
          <div><strong>Project idea: PHP + JavaScript</strong></div>
          <div class="small-muted">Online quiz system with leaderboard</div>
        </div>
      </div>

      <div class="example" data-idx="4" onclick="loadExample(4)">
        <div class="avatar" style="background:linear-gradient(135deg,#FF5E8A,#FF7FB3)">Q5</div>
        <div>
          <div><strong>MySQL: Unknown column</strong></div>
          <div class="small-muted">Debugging checklist</div>
        </div>
      </div>

      <div style="height:8px"></div>
      <div class="controls">
        <button class="nav-btn" id="clear-history">Clear history</button>
        <button class="nav-btn" id="export-chat">Export</button>
      </div>

      <div style="height:12px"></div>
      <div class="small-muted">Tip: Type any of the questions (or a similar phrase) in the chat and I’ll answer with Overview → Steps → Code → Tips.</div>
    </aside>

    <!-- Chat center -->
    <section class="chat" aria-live="polite" aria-label="Chat area">
      <div class="messages" id="messages" role="log" aria-atomic="false"></div>

      <div class="composer" aria-label="Message composer">
        <textarea id="input" placeholder="Ask: 'What is an API?' or 'How to connect PHP form to MySQL?'" aria-label="Message input"></textarea>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="send" id="sendBtn" title="Send (Enter)">Send</button>
          <div class="meta" style="text-align:right">Enter = send · Shift+Enter = newline</div>
        </div>
      </div>
    </section>

    <!-- Right-side panel -->
    <aside class="sidepanel" id="sidepanel" aria-label="Answer details">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:600">Response details</div>
        <div style="font-size:13px;color:var(--muted)">Format: Overview → Steps → Code → Tips</div>
      </div>

      <div class="tabs" role="tablist" aria-label="Response tabs">
        <div class="tab active" id="tab-steps" role="tab" onclick="switchTab('steps')">Steps</div>
        <div class="tab" id="tab-code" role="tab" onclick="switchTab('code')">Code</div>
        <div class="tab" id="tab-tips" role="tab" onclick="switchTab('tips')">Tips</div>
      </div>

      <div class="panel" id="panel-steps"><div class="small-muted">No selection yet — ask a question or click an example.</div></div>
      <div class="panel hidden" id="panel-code"></div>
      <div class="panel hidden" id="panel-tips"></div>
    </aside>
  </main>

  <footer>
    <div style="max-width:1200px;margin:0 auto;text-align:left;color:var(--muted)">&copy; CodeMentor Pro — Built for students. Data saved only in your browser.</div>
  </footer>

<script>
/* ------------------------
   Data: the five Q&A templates
   flexible keywords arrays + full structured answer
   ------------------------ */
const knowledge = [
  {
    id: 'api',
    keywords: ['api','what is api','explain api','what is an api','explain an api','what\'s an api','api simple'],
    answer: {
      overview: "An API is like a waiter in a restaurant — it takes your request to the kitchen (server) and brings back the response (data).",
      steps: [
        "Client makes a request (you order).",
        "API (waiter) forwards the request to the server (kitchen).",
        "Server processes and prepares data (cook the dish).",
        "API returns the response to the client (waiter brings the food)."
      ],
      code: `// Example: using Google Maps geocoding API with fetch (browser)
fetch('https://maps.googleapis.com/maps/api/geocode/json?address=Delhi&key=YOUR_API_KEY')
  .then(res => res.json())
  .then(data => console.log(data))
  .catch(err => console.error(err));`,
      tips: [
        "APIs let apps communicate without sharing internal details.",
        "Read the API documentation to learn endpoints and limits.",
        "Use API keys responsibly (don't commit them to public repos).",
        "Free APIs (Google Maps free tier, OpenWeather) are great for practice."
      ]
    }
  },

  {
    id: 'php-mysql',
    keywords: ['php form mysql','connect php to mysql','php mysql','how to connect php form to mysql','php form to mysql','php mysqli_connect'],
    answer: {
      overview: "Create a PHP form that securely inserts user input into a MySQL database using prepared statements.",
      steps: [
        "Create a MySQL database and table (e.g., users with name and email).",
        "Build an HTML form (method='post').",
        "In PHP, use mysqli or PDO to connect to the database.",
        "Use prepared statements to insert data and avoid SQL injection."
      ],
      code: `<!-- form.html -->
<form action="submit.php" method="post">
  <input name="name" required placeholder="Name">
  <input name="email" type="email" required placeholder="Email">
  <button type="submit">Submit</button>
</form>

<!-- submit.php -->
<?php
$conn = new mysqli('localhost','db_user','db_pass','db_name');
if($conn->connect_error) die('Connection failed');

$name = $_POST['name'];
$email = $_POST['email'];

$stmt = $conn->prepare("INSERT INTO users (name,email) VALUES (?, ?)");
$stmt->bind_param('ss', $name, $email);
$stmt->execute();
$stmt->close();
$conn->close();
?>`,
      tips: [
        "Always validate & sanitize input both client- and server-side.",
        "Prepared statements prevent SQL injection — use them.",
        "Test locally (XAMPP/LAMP) before deploying.",
        "Free hosting options: GitHub Pages for static frontends; InfinityFree for PHP apps (hobby)."
      ]
    }
  },

  {
    id: 'portfolio',
    keywords: ['portfolio','programming portfolio','first portfolio','what to include in portfolio','portfolio contents'],
    answer: {
      overview: "A first portfolio should highlight who you are, what you can do, and include 2–3 live projects with code and screenshots.",
      steps: [
        "About Me: short intro and your goals.",
        "Skills: languages, frameworks, tools.",
        "Projects: 2–3 showcase projects with description, tech used, repo link, and screenshots.",
        "Education & Contact: college, certifications, email / LinkedIn."
      ],
      code: `# Simple folder structure
portfolio/
  index.html     # About + links
  projects/      # each project page with README & screenshots
  assets/        # images and CSS
  resume.pdf`,
      tips: [
        "Host on GitHub Pages or Netlify (free).",
        "Write clear READMEs explaining setup & challenges solved.",
        "Add small demos and screenshots instead of just code.",
        "Keep it concise — recruiters scan fast."
      ]
    }
  },

  {
    id: 'php-js-project',
    keywords: ['php js project','project idea php javascript','php + javascript project','quiz project','online quiz project'],
    answer: {
      overview: "Build an Online Quiz System: users login, take timed quizzes, and a leaderboard shows top scorers — it teaches frontend timers, AJAX, backend storage and authentication.",
      steps: [
        "Design DB: users, quizzes, questions, scores.",
        "Create frontend with JS for quiz UI and timer.",
        "Use AJAX/fetch to send/receive questions and save answers to PHP endpoints.",
        "Implement leaderboard powered by server-side queries."
      ],
      code: `-- SQL (example)
CREATE TABLE scores (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(100),
  score INT,
  taken_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);`,
      tips: [
        "Start with a single quiz and 5–10 questions.",
        "Use AJAX to load questions without page reloads.",
        "Secure endpoints (validate on server) to avoid cheating.",
        "Deploy frontend on Netlify and backend on a simple PHP host or shared host."
      ]
    }
  },

  {
    id: 'unknown-column',
    keywords: ['unknown column','mysql unknown column','unknown column error','unknown column in field list'],
    answer: {
      overview: "“Unknown column” usually means the column name in your query doesn't exist or is misspelled.",
      steps: [
        "Check for typos in the column name in your SQL query.",
        "Confirm the column exists: use `DESCRIBE table_name;` or `SHOW COLUMNS FROM table_name;`",
        "If you recently renamed or migrated columns, ensure code and DB schema match.",
        "Watch out for quoting/backticks and accidental string usage instead of column name."
      ],
      code: `-- Debugging command
DESCRIBE users;`,
      tips: [
        "Keep migrations in version control so schema changes are tracked.",
        "Use consistent naming conventions (snake_case) to avoid confusion.",
        "Log the final query (with values redacted) to see what was executed."
      ]
    }
  }
];

/* ------------------------
   Utility functions
   ------------------------ */
function saveChat(history){
  try{ localStorage.setItem('codementor_history_v1', JSON.stringify(history)); }catch(e){}
}
function loadChat(){
  try{ const d = localStorage.getItem('codementor_history_v1'); return d ? JSON.parse(d) : []; }catch(e){ return [];}
}
function clearChatStorage(){ localStorage.removeItem('codementor_history_v1'); }

/* ------------------------
   Chat rendering & state
   ------------------------ */
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('input');
const sideSteps = document.getElementById('panel-steps');
const sideCode = document.getElementById('panel-code');
const sideTips  = document.getElementById('panel-tips');

let chatHistory = loadChat(); // array of {role:'me'|'bot', text:..., meta?:{}}
renderHistory();

/* render saved messages */
function renderHistory(){
  messagesEl.innerHTML = '';
  for(const m of chatHistory){
    appendMessageToUI(m.role, m.text, false);
  }
  scrollBottom();
}

/* append message both to UI and history (and save) */
function appendMessage(role, text, meta = {}){
  chatHistory.push({role, text, meta});
  saveChat(chatHistory);
  appendMessageToUI(role, text, true);
}
function appendMessageToUI(role, text, animate=true){
  const div = document.createElement('div');
  div.className = 'msg ' + (role === 'me' ? 'me' : 'bot');
  div.innerHTML = `<strong>${role === 'me' ? 'You' : 'CodeMentor Pro'}</strong><div style="margin-top:6px">${text}</div>` ;
  messagesEl.appendChild(div);
  if(animate) div.style.opacity = '0';
  requestAnimationFrame(()=>{ div.style.opacity = '1'; });
  scrollBottom();
}
function scrollBottom(){ messagesEl.scrollTop = messagesEl.scrollHeight; }

/* ------------------------
   Matching logic (flexible)
   - assign score by counting keyword hits (simple but effective)
   ------------------------ */
function findBestMatch(userText){
  const normalized = userText.toLowerCase().replace(/[^\w\s]/g,' ');
  const words = normalized.split(/\s+/).filter(Boolean);
  let best = {score:0, idx:-1};
  for(let i=0;i<knowledge.length;i++){
    const entry = knowledge[i];
    // score by keyword presence or how many keyword tokens appear
    let score = 0;
    for(const kw of entry.keywords){
      if(normalized.includes(kw)) score += 3;       // exact phrase match strong
    }
    // token overlap (looser)
    for(const w of words){
      for(const kw of entry.keywords){
        if(kw.includes(w) || w.includes(kw)) score += 0.6;
      }
    }
    // small boost if some important words present
    const important = ['api','php','mysql','portfolio','quiz','unknown','column'];
    for(const imp of important){ if(words.includes(imp) && entry.id.includes(imp)) score += 2; }
    if(score > best.score){ best = {score, idx:i}; }
  }
  // threshold to avoid accidental matches
  return best.score >= 2 ? knowledge[best.idx] : null;
}

/* ------------------------
   Bot reply flow
   ------------------------ */
function replyTo(userText){
  const match = findBestMatch(userText);
  if(match){
    // formatted answer: show overview in chat, and fill side panels
    const ans = match.answer;
    const markup = `<b>Overview:</b> ${escapeHtml(ans.overview)}<div class="assistant-format">Overview → Steps → Code → Tips</div>`;
    appendMessage('bot', markup);
    // render side tabs
    renderSide(ans);
  } else {
    appendMessage('bot', escapeHtml("I don’t have a direct match for that yet. Ask in another way (example: 'What is an API?' or 'How to connect PHP form to MySQL?'), or I'll guide you step-by-step."));
    clearSide();
  }
}

/* ------------------------
   Side panel rendering & tab logic
   ------------------------ */
function renderSide(ans){
  // Steps
  sideSteps.innerHTML = `<ol class="steps">${ans.steps.map(s => `<li>${escapeHtml(s)}</li>`).join('')}</ol>`;
  // Code
  sideCode.innerHTML = `<pre class="code-block">${escapeHtml(ans.code)}</pre>`;
  // Tips
  sideTips.innerHTML = `<ul class="tips">${ans.tips.map(t => `<li>${escapeHtml(t)}</li>`).join('')}</ul>`;
  // switch to Steps tab by default
  switchTab('steps');
}
function clearSide(){
  sideSteps.innerHTML = `<div class="small-muted">No structured answer available — try a suggested example or rephrase your question.</div>`;
  sideCode.innerHTML = '';
  sideTips.innerHTML = '';
}

/* tabs */
function switchTab(name){
  const allTabs = ['steps','code','tips'];
  for(const t of allTabs){
    document.getElementById('tab-'+t).classList.toggle('active', t === name);
    document.getElementById('panel-'+t).classList.toggle('hidden', t !== name);
  }
}

/* ------------------------
   Input handling: send, Enter/Shift+Enter
   ------------------------ */
document.getElementById('sendBtn').addEventListener('click', onSend);
inputEl.addEventListener('keydown', function(e){
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    onSend();
  }
});
function onSend(){
  const txt = inputEl.value.trim();
  if(!txt) return;
  appendMessage('me', escapeHtml(txt));
  inputEl.value = '';
  // emulate slight thinking delay
  setTimeout(()=> replyTo(txt), 450);
}

/* ------------------------
   Sidebar quick examples
   ------------------------ */
function loadExample(idx){
  const ex = knowledge[idx];
  const sampleQuestion = ex.keywords[0];
  appendMessage('me', escapeHtml(sampleQuestion));
  setTimeout(()=> replyTo(sampleQuestion), 250);
}
window.loadExample = loadExample;

/* ------------------------
   Nav: Chat / Resources / About
   ------------------------ */
const navChat = document.getElementById('nav-chat');
const navResources = document.getElementById('nav-resources');
const navAbout = document.getElementById('nav-about');

navChat.addEventListener('click', ()=> { setActiveNav('chat'); });
navResources.addEventListener('click', ()=> { setActiveNav('resources'); });
navAbout.addEventListener('click', ()=> { setActiveNav('about'); });

function setActiveNav(tab){
  navChat.classList.toggle('active', tab==='chat');
  navResources.classList.toggle('active', tab==='resources');
  navAbout.classList.toggle('active', tab==='about');

  // show/hide main pieces
  const layout = document.querySelector('.layout');
  const resourcesHtml = `
    <aside class="sidebar" style="grid-column:1/-1;">
      <h3>Resources — Free & student-friendly</h3>
      <div class="resources-list">
        <div class="resource"><strong>Free static hosting</strong><div class="small-muted">GitHub Pages, Netlify — host portfolios & frontend projects.</div></div>
        <div class="resource"><strong>Free PHP / MySQL hosts</strong><div class="small-muted">InfinityFree (hobby), 000webhost — okay for practice.</div></div>
        <div class="resource"><strong>Free APIs for practice</strong><div class="small-muted">OpenWeather, TheMealDB, Public-APIs list — great for small projects.</div></div>
        <div class="resource"><strong>Indian student communities</strong><div class="small-muted">Search for 'GeeksforGeeks student', 'DSA India', and local college Discord/Telegram groups.</div></div>
        <div class="resource"><strong>Resume & Interview</strong><div class="small-muted">Use simple templates (Markdown → PDF), practice mock interviews with peers, add GitHub project links.</div></div>
      </div>
    </aside>
  `;
  const aboutHtml = `
    <aside class="sidebar" style="grid-column:1/-1;">
      <h3>About CodeMentor Pro</h3>
      <div class="small-muted">Designed for Indian CS & IT students (18–25). Tone: friendly, encouraging, step-by-step guidance. Saves conversation locally in your browser. Built as a prototype UI for the Lenovo Leap Internship Project — Week 5 AI Project Report: CodeMentor Pro.</div>
    </aside>
  `;

  // remove any inserted full-width items
  // (we'll simply toggle visibility of layout's children)
  const sidebar = document.querySelector('.sidebar');
  const chat = document.querySelector('.chat');
  const sidepanel = document.querySelector('.sidepanel');

  if(tab === 'chat'){
    sidebar.style.display = '';
    chat.style.display = '';
    sidepanel.style.display = '';
    // restore header nav active states handled above
  } else if(tab === 'resources'){
    // hide main columns and show resources full-width area
    sidebar.style.display = 'none';
    chat.style.display = 'none';
    sidepanel.style.display = 'none';
    // insert resources container after header if not present
    if(!document.getElementById('resources-full')){
      const node = document.createElement('div');
      node.id = 'resources-full';
      node.innerHTML = resourcesHtml;
      document.querySelector('main.layout').insertBefore(node, document.querySelector('main.layout').firstChild);
    }
  } else if(tab === 'about'){
    sidebar.style.display = 'none';
    chat.style.display = 'none';
    sidepanel.style.display = 'none';
    if(!document.getElementById('about-full')){
      const node = document.createElement('div');
      node.id = 'about-full';
      node.innerHTML = aboutHtml;
      document.querySelector('main.layout').insertBefore(node, document.querySelector('main.layout').firstChild);
    }
  }

  // remove resources or about if switching back to chat
  if(tab === 'chat'){
    const res = document.getElementById('resources-full'); if(res) res.remove();
    const abt = document.getElementById('about-full'); if(abt) abt.remove();
  } else {
    // when moving to resources/about, ensure the other full-width removed
    const res = document.getElementById('resources-full'); if(res && tab === 'about') res.remove();
    const abt = document.getElementById('about-full'); if(abt && tab === 'resources') abt.remove();
  }
}

/* ------------------------
   Controls: clear history, export
   ------------------------ */
document.getElementById('clear-history').addEventListener('click', ()=> {
  if(confirm('Clear chat history locally? This will remove saved messages in your browser.')) {
    chatHistory = [];
    saveChat(chatHistory);
    messagesEl.innerHTML = '';
    clearSide();
  }
});
document.getElementById('export-chat').addEventListener('click', ()=> {
  const text = chatHistory.map(m => `${m.role.toUpperCase()}: ${m.text.replace(/<[^>]*>/g,'')}`).join('\n\n');
  const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'codementor_chat.txt'; a.click();
  URL.revokeObjectURL(url);
});

/* ------------------------
   Small helpers
   ------------------------ */
function escapeHtml(str){
  if(!str && str !== '') return '';
  return String(str).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
}

/* initial UI */
clearSide();
switchTab('steps');
setActiveNav('chat');
scrollBottom();

/* make knowledge click handlers (sidebar) */
for(let i=0;i<knowledge.length;i++){
  // already wired via loadExample, no further setup needed
}
</script>
</body>
</html>
